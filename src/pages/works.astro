---
import BaseLayout from "../layouts/BaseLayout.astro";
import GalleryLightbox from "../components/GalleryLightbox.astro";
import {
  portfolioByCategory,
  blackworkItems,
  colorItems,
  fineLineItems,
  variosItems,
  getPortfolioAlt,
} from "../data/portfolio";

const whatsappLink = "https://wa.me/34600254338";
const instagramLink = "https://www.instagram.com/vigarartattoo/";

const categories = [
  {
    key: "fine-line",
    title: "Fine line",
    desc: "Trazos finos, delicados y elegantes.",
  },
  {
    key: "blackwork",
    title: "Blackwork",
    desc: "Negro sólido, contraste y piezas potentes.",
  },
  {
    key: "color",
    title: "Color",
    desc: "Piezas vibrantes con contraste y detalle.",
  },
  {
    key: "varios",
    title: "Varios",
    desc: "Trabajos mixtos y estilos combinados.",
  },
] as const;

const heroImageSrc = "/images/heroImg/rocio_002.jpeg";
const lang = "es";

const curatedByCategory = {
  blackwork: blackworkItems,
  color: colorItems,
  "fine-line": fineLineItems,
  varios: variosItems,
} as const;
---

<BaseLayout title="Trabajos | Vigarartattoo">
  <main class="mx-auto max-w-6xl px-4">
    <!-- Sticky header (appears on scroll) -->
    <div
      class="sticky-header pointer-events-none fixed left-0 right-0 top-0 z-[60] hidden"
      data-sticky-header
      data-hide-on-lightbox
    >
      <div class="mx-auto max-w-3xl px-4 pt-3">
        <div
          class="pointer-events-auto relative flex items-center justify-between gap-3 rounded-full glass-strong px-4 py-2"
        >
          <a href="/" class="text-sm font-semibold tracking-wide text-glass">
            Vigarartattoo
          </a>

          <!-- ✅ NOW md+ (iPad included) -->
          <nav
            class="hidden items-center gap-3 text-sm text-zinc-200 md:flex text-glass"
            data-section-nav
          >
            <a
              class="nav-pill hover:text-white border border-transparent rounded-full px-2 py-1"
              href="#fine-line"
              data-section-link="fine-line">Fine line</a
            >
            <a
              class="nav-pill hover:text-white border border-transparent rounded-full px-2 py-1"
              href="#blackwork"
              data-section-link="blackwork">Blackwork</a
            >
            <a
              class="nav-pill hover:text-white border border-transparent rounded-full px-2 py-1"
              href="#color"
              data-section-link="color">Color</a
            >
            <a
              class="nav-pill hover:text-white border border-transparent rounded-full px-2 py-1"
              href="#varios"
              data-section-link="varios">Varios</a
            >
          </nav>

          <!-- Right side: language (md+) + CTA -->
          <div class="flex items-center gap-2">
            <!-- ✅ Language switcher (md+ only, so it also shows on iPad) -->
            <div class="hidden md:flex items-center gap-2 text-xs text-zinc-300">
              <a
                class="rounded-full border border-white/10 px-2.5 py-1 bg-white/10 text-white"
                href="/works"
                aria-current="page">ES</a
              >
              <a
                class="rounded-full border border-white/10 px-2.5 py-1 hover:bg-white/5"
                href="/en/works">EN</a
              >
            </div>

            <a
              class="rounded-full bg-white px-3 py-1.5 text-sm font-semibold text-zinc-950 hover:bg-zinc-200"
              href={whatsappLink}
              target="_blank"
              rel="noreferrer"
            >
              Reservar
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- NAV -->
    <header class="relative flex items-center justify-between py-6">
      <a href="/works" class="text-lg font-semibold tracking-wide">
        Vigarartattoo
      </a>

      <!-- ✅ Language switcher (mobile ONLY - centered) -->
      <div
        class="md:hidden absolute left-1/2 -translate-x-1/2 flex items-center gap-2 text-xs text-zinc-300"
      >
        <a
          class="rounded-full border border-white/10 px-2.5 py-1 bg-white/10 text-white"
          href="/works"
          aria-current="page"
        >
          ES
        </a>
        <a
          class="rounded-full border border-white/10 px-2.5 py-1 hover:bg-white/5"
          href="/en/works"
        >
          EN
        </a>
      </div>

      <!-- ✅ Top nav (tablet + desktop = md+) -->
      <nav
        class="hidden items-center gap-6 text-sm text-zinc-300 md:flex"
        data-section-nav
      >
        <a
          class="nav-pill hover:text-white"
          href="#fine-line"
          data-section-link="fine-line">Fine line</a
        >
        <a
          class="nav-pill hover:text-white"
          href="#blackwork"
          data-section-link="blackwork">Blackwork</a
        >
        <a
          class="nav-pill hover:text-white"
          href="#color"
          data-section-link="color">Color</a
        >
        <a
          class="nav-pill hover:text-white"
          href="#varios"
          data-section-link="varios">Varios</a
        >
      </nav>

      <!-- ✅ Mobile menu button (ONLY < md) -->
      <div class="flex items-center gap-3 md:hidden">
        <button
          type="button"
          class="inline-flex items-center justify-center rounded-2xl border border-white/15 bg-white/5 px-4 py-2 text-sm font-semibold text-white hover:bg-white/10"
          aria-label="Abrir menú"
          data-menu-open
        >
          Menú
        </button>
      </div>

      <!-- ✅ Language switcher (tablet + desktop = md+) -->
      <div class="hidden items-center gap-2 text-sm text-zinc-300 md:flex">
        <a
          class="rounded-full border border-white/10 px-3 py-1 bg-white/10 text-white"
          href="/works"
          aria-current="page"
        >
          ES
        </a>
        <a
          class="rounded-full border border-white/10 px-3 py-1 hover:bg-white/5"
          href="/en/works"
        >
          EN
        </a>
      </div>

      <!-- ✅ Mobile overlay (ONLY mobile) -->
      <div
        class="menu-overlay fixed inset-0 z-50 hidden md:hidden"
        data-menu-overlay
        aria-hidden="true"
      >
        <button
          class="menu-backdrop absolute inset-0 bg-black/70"
          aria-label="Cerrar menú"
          data-menu-close
          type="button"></button>

        <div
          class="menu-panel absolute right-0 top-0 h-full w-[85%] max-w-sm border-l border-white/10 bg-zinc-950 p-6"
        >
          <div class="flex items-center justify-between">
            <div class="text-lg font-semibold">Vigarartattoo</div>
            <button
              type="button"
              class="rounded-2xl border border-white/15 bg-white/5 px-4 py-2 text-sm font-semibold text-white hover:bg-white/10"
              aria-label="Cerrar menú"
              data-menu-close
            >
              Cerrar
            </button>
          </div>

          <nav class="mt-8 grid gap-4 text-base">
            <a class="menu-link" href="#fine-line" data-menu-link>Fine line</a>
            <a class="menu-link" href="#blackwork" data-menu-link>Blackwork</a>
            <a class="menu-link" href="#color" data-menu-link>Color</a>
            <a class="menu-link" href="#varios" data-menu-link>Varios</a>

            <a
              class="mt-3 rounded-2xl bg-white px-4 py-3 text-center font-semibold text-zinc-950 hover:bg-zinc-200"
              href={whatsappLink}
              target="_blank"
              rel="noreferrer"
            >
              Reservar por WhatsApp
            </a>

            <a
              class="rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-center hover:bg-white/10"
              href={instagramLink}
              target="_blank"
              rel="noreferrer"
            >
              Instagram
            </a>
          </nav>
        </div>
      </div>
    </header>

    <!-- HERO -->
    <section
      id="top"
      class="relative overflow-hidden rounded-3xl border border-white/10 bg-zinc-950"
    >
      <img
        src={heroImageSrc}
        alt="Rocío tatuando en su estudio"
        class="absolute inset-0 h-full w-full object-cover"
        loading="eager"
        decoding="async"
        fetchpriority="high"
      />

      <div
        class="absolute inset-0 bg-gradient-to-r from-black/85 via-black/60 to-black/25"
      >
      </div>
      <div class="absolute inset-0 backdrop-blur-[1px]"></div>

      <div class="relative px-6 py-16 md:px-12 md:py-20">
        <p class="text-xs uppercase tracking-[0.35em] text-zinc-200/80">
          Portfolio completo
        </p>

        <h1
          class="mt-4 text-4xl font-semibold leading-tight text-white md:text-6xl"
        >
          Trabajos
        </h1>

        <p class="mt-6 max-w-2xl text-base text-zinc-200 md:text-lg">
          Explora los tatuajes por estilos. Cada pieza está pensada para encajar
          contigo, tu idea y tu piel.
        </p>
      </div>
    </section>

    <!-- SECTIONS -->
    <div class="space-y-20 pb-20 pt-12">
      {
        categories.map((c) => {
          const sourceItems =
            curatedByCategory[c.key] ?? (portfolioByCategory[c.key] ?? []);

          const items = sourceItems.map((i) => ({
            ...i,
            alt: getPortfolioAlt(i, lang),
          }))

          const galleryId = `works-${c.key}`

          return (
            <section id={c.key} class="scroll-mt-32 reveal">
              <header class="mb-6">
                <h2 class="text-2xl font-semibold md:text-3xl">{c.title}</h2>
                <p class="mt-2 text-sm text-zinc-400">{c.desc}</p>
              </header>

              <GalleryLightbox items={items} galleryId={galleryId} />
            </section>
          )
        })
      }
    </div>

    <footer class="border-t border-white/10 py-8 text-sm text-zinc-500">
      © {new Date().getFullYear()} Vigarartattoo
    </footer>
  </main>
</BaseLayout>
